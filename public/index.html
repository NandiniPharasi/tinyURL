<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TinyURL Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-50 text-gray-900 min-h-screen p-8">

  <div class="max-w-4xl mx-auto">

    <!-- Header -->
    <div class="flex items-center justify-between mb-8">
      <h1 class="text-4xl font-extrabold tracking-tight text-gray-800">
        üîó TinyURL Dashboard
      </h1>
    </div>

    <!-- Card -->
    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">

      <!-- Create Form -->
      <h2 class="text-2xl font-bold mb-4">Create Short URL</h2>

      <form id="createForm" class="space-y-4">

        <input id="urlInput"
               class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-blue-400 focus:outline-none"
               type="text" placeholder="Enter long URL" required>

        <input id="customCodeInput"
               class="w-full border border-gray-300 p-3 rounded-lg focus:ring-2 focus:ring-blue-400 focus:outline-none"
               type="text" placeholder="Custom code (optional)">

        <button type="submit"
                class="bg-blue-600 text-white px-5 py-2.5 rounded-lg hover:bg-blue-700 transition font-semibold shadow">
          Create Short URL
        </button>
      </form>

      <!-- Result -->
      <p id="result" class="mt-4 font-semibold text-green-700"></p>

      <hr class="my-8">

      <!-- All Links -->
      <h2 class="text-2xl font-bold mb-4">All Shortened Links</h2>

      <div class="overflow-hidden rounded-lg border border-gray-300 shadow-sm">

        <table class="w-full border-collapse">
          <thead class="bg-gray-100 text-gray-700">
            <tr>
              <th class="border p-3 text-left font-semibold">Code</th>
              <th class="border p-3 text-left font-semibold">URL</th>
              <th class="border p-3 text-left font-semibold">Visits</th>
              <th class="border p-3 text-left font-semibold">Actions</th>
            </tr>
          </thead>
          <tbody id="linksTable" class="bg-white"></tbody>
        </table>

      </div>

    </div>

  </div>

<script>
// Load all links
async function loadLinks() {
  const res = await fetch("/api/links");
  const links = await res.json();

  const table = document.getElementById("linksTable");
  table.innerHTML = "";

  links.forEach(link => {
    table.innerHTML += `
      <tr class="hover:bg-gray-50 transition">
        <td class="border p-3">
          <a href="/${link.code}" class="text-blue-600 font-semibold underline">${link.code}</a>
        </td>
        <td class="border p-3 text-gray-700">${link.url}</td>
        <td class="border p-3 font-bold text-green-700">${link.visits}</td>
        <td class="border p-3 space-x-3">
          
          <a href="/code/${link.code}"
             class="text-indigo-600 font-semibold hover:text-indigo-800 transition">
             üìä Stats
          </a>

          <button type="button"
                  class="text-red-600 font-semibold hover:text-red-800 transition"
                  onclick="deleteLink('${link.code}')">
            ‚ùå Delete
          </button>
        </td>
      </tr>
    `;
  });
}

// Create short URL
document.getElementById("createForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const url = document.getElementById("urlInput").value;
  const customCode = document.getElementById("customCodeInput").value;

  const res = await fetch("/api/links", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ url, customCode })
  });

  const data = await res.json();

  if (res.status === 200) {
    document.getElementById("result").innerText =
      `Short URL created: ${data.shortUrl}`;
    loadLinks();
  } else {
    document.getElementById("result").innerText = "Error: " + data.error;
  }
});

// Delete short link
async function deleteLink(code) {
  if (!confirm("Delete this short link?")) return;

  await fetch(`/api/links/${code}`, { method: "DELETE" });
  loadLinks();
}

// Initial load
loadLinks();
</script>

</body>
</html>
